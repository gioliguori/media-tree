services:
#  redis:
#    image: redis:7-alpine
#    container_name: media-tree-redis
#    ports:
#      - "6379:6379"
#    networks:
#      - media-tree
#    healthcheck:
#      test: ["CMD", "redis-cli", "ping"]
#      interval: 5s
#      timeout: 3s
#      retries: 5

  controller:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: media-tree-controller
    ports:
      - "8080:8080" 
    environment:
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: ""
      REDIS_DB: 0
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    #depends_on:
    #  redis:
    #    condition: service_healthy
    networks:
      - test-network
      - media-tree
    restart: unless-stopped

networks:
  media-tree:
    driver: bridge
  test-network:
    external: true
    name: test_media-tree